<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Location Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="css/location.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.2/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script src="js/locationscript.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
  </head>
  <body style="background-color: #002A7F;">
      <div class="menu-container" >
         <div class="dropdown">Menu<span class="bi bi-chevron-down"></span></div>
        <!-- <div class="dropdown">Menu<span class="fas fa-bars"></span></div> -->
        <ul>
            <li><a href="#">Kedoya</a></li>
            <li><a href="#">Bandung</a></li>
            <li><a href="#">Joglo</a></li>
            <li><a href="#">Aceh</a></li>
            <li><a href="#">Biro Semarang</a></li> 
            <li><a href="#">Makasar</a></li>
            <li><a href="#">Transmisi Semarang</a></li>
            <li><a href="#">Transmisi Surabaya</a></li>
            <li><a href="#">Transmisi Denpasar</a></li>
            <li><a href="#">Transmisi Yogyakarta</a></li>
          </ul>
      </div>
      <!-- <div style="height: 300px; ">
          <br>
      </div> -->
      <div class="d-flex justify-content-center">
          <div class="mainBottom">
              <div id="getLocationContent" class="d-flex align-items-center flex-column">
                <div class="p-2" style="margin: 0 35px 0 35px; text-align: center">
                    <p style="overflow: auto;"> *Pilih lokasi kantor/biro tempat anda bekerja </p>
                </div>    
                  <div class="p-2">
                      <div class="d-flex align-items-center flex-column">
                          <button type="button" class="btn btn-primary" id="getDistance" onclick="getLocation()"> Get your current location </button>
                      </div>
                      <div id="showPosition"  class="d-flex align-items-center flex-column">
                
                          <h2 class="p-2">Position:</h2>
                          <p class="p-2" id="location"></p>
                          <p class="p-2" id="distance"></p>
                          
                          <p class="p-2">Work status: WFO</p>
                      </div>
                  </div>
                  <div class="p-2">
                      <form action="attendance.html">
                          <button type="submit" class="btn btn-primary" style="width: 270px" id="confirmBtn"> Confirm</button>
                      </form>
                      <!-- <button type="button" class="btn btn-block" style="width: 270px"> Confirm</button> -->
                  </div>
              </div>
          </div>
      </div>

      <script>
        $(document).ready(function(){
            $('.dropdown').click(function(){
                if($(this).hasClass('expand')){
                    $('ul').slideUp(function(){
                        $('.dropdown').removeClass('expand');
                        $('.fas').removeClass('expand'); 

                    })
                }

                else {
                    $(this).addClass('expand');
                    setTimeout(function(){
                        $('.fas').addClass('expand'); 
                        $('ul').stop().slideDown();
                    },200);
                }
            });
        });

        var kedoyaLat =  -6.186957018673723;
        var kedoyaLong = 106.7585642800948;

        var x = document.getElementById("location");
        var y = document.getElementById("distance");
        
        function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
        }
        
        //compare distance as the crow flies
        function calcCrow(lat1, lon1, lat2, lon2) 
        {
            var R = 6371; // km
            var dLat = toRad(lat2-lat1);
            var dLon = toRad(lon2-lon1);
            var lat1 = toRad(lat1);
            var lat2 = toRad(lat2);
            
            var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            var d = R * c;
            return d;
        }
        
        // Converts numeric degrees to radians
        function toRad(Value) 
        {
            return Value * Math.PI / 180;
        }

        function showPosition(position) {
        x.innerHTML = "Latitude: " + position.coords.latitude +
        "<br>Longitude: " + position.coords.longitude;
        y.innerHTML = "Your distance to the office is: " + 
        (calcCrow(kedoyaLat, kedoyaLong, position.coords.latitude, position.coords.longitude).toFixed(1)) +
        " km"
        }
        
      </script>

  </body>
</html>